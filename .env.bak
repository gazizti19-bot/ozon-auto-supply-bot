############################
# ====== BASE / OZON ====== #
############################
# ПУСТЫМИ оставь OZON_CLIENT_ID / OZON_API_KEY для MOCK режима
OZON_CLIENT_ID=1428745
OZON_API_KEY=10e95c19-0db4-4835-a3ac-dcc02b9e3592

############################
# ====== TELEGRAM ========= #
############################
TELEGRAM_BOT_TOKEN=8248717287:AAEwgczKNuXrO8IGfeQX0toGcqwuLsATUig
TELEGRAM_TOKEN=${TELEGRAM_BOT_TOKEN}

############################
# ====== STOCK LOGIC ===== #
############################
MIN_STOCK=100
TARGET_MULTIPLIER=2
HISTORY_RETENTION_DAYS=120
HISTORY_LOOKBACK_DAYS=90
MIN_HISTORY_HOURS=6
MAX_HISTORY_POINTS=300
MAX_HISTORY_SNAPSHOTS=5000

# Интервалы
SNAPSHOT_INTERVAL_MINUTES=30
SNAPSHOT_STALE_MINUTES=15
SNAPSHOT_MIN_REUSE_SECONDS=120
HISTORY_PRUNE_EVERY_MINUTES=360

# Ежедневный отчёт
DAILY_NOTIFY_HOUR=9
DAILY_NOTIFY_MINUTE=0
TZ=Asia/Yekaterinburg

# Таймауты / производительность
API_TIMEOUT_SECONDS=15
HEALTH_WARN_LATENCY_MS=4000
SAVE_BUFFER_FLUSH_SECONDS=30

############################
# ====== DATA DIR ========= #
############################
DATA_DIR=/app/data

############################
# ====== SKU LIST ========= #
############################
# Формат: числа через запятую
SKU_LIST=2625768907,2190914633,2060037518,1985257923,1762013830,1327503774,1327503377

################################
# ====== LLM / GigaChat ======= #
################################
LLM_PROVIDER=gigachat
GIGACHAT_CLIENT_ID=dd634eae-d4e2-4b3c-b727-6996ef74ebd5
GIGACHAT_CLIENT_SECRET=dedb530b-c4ec-47a5-9631-687a728393ce
GIGACHAT_SCOPE=GIGACHAT_API_CORP
GIGACHAT_TOKEN_URL=https://ngw.devices.sberbank.ru:9443/api/v2/oauth
GIGACHAT_API_URL=https://gigachat.devices.sberbank.ru/api/v1/chat/completions
GIGACHAT_MODEL=GigaChat
GIGACHAT_TEMPERATURE=0.30
GIGACHAT_MAX_TOKENS=800
GIGACHAT_TIMEOUT_SECONDS=30
GIGACHAT_TOKEN_CACHE=keys/gigachat_token_cache.json

# SSL режимы:
#   custom   -> использовать файл CA
#   insecure -> отключить проверку (НЕ для прод)
#   auto     -> системный trust store
GIGACHAT_SSL_MODE=custom
GIGACHAT_CA_CERT=/app/ca/gigachat_ca.pem
GIGACHAT_VERIFY_SSL=1

# AI частота
AI_MIN_INTERVAL_SECONDS=5

##################################
# ====== FACT / AI ТОНКАЯ ====== #
##################################
LLM_ENABLE_ANSWER_CACHE=1
LLM_STYLE_ENABLED=1
DEFAULT_CHAT_MODE=fact
LLM_GENERAL_TEMPERATURE=0.70
LLM_TOP_DEFICITS=20
LLM_TOP_WAREHOUSES=8
LLM_TOP_CLUSTERS=8
LLM_MAX_CONTEXT_SKU=10
LLM_MAX_CONTEXT_WAREHOUSES=6
LLM_INVENTORY_SAMPLE_SKU=50
LLM_FULL_DETAIL_SKU=25
LLM_FULL_DETAIL_WAREHOUSES=6
LLM_FACT_SOFT_LIMIT_CHARS=18000
GENERAL_HISTORY_MAX=12

##################################
# ====== CLUSTERS (опц.) ======= #
##################################
# Формат 1 (JSON): WAREHOUSE_CLUSTERS={"1":"Юг","2":"Санкт-Петербург и СЗО"}
# Формат 2 (pairs): WAREHOUSE_CLUSTERS=1=Юг;2="Санкт-Петербург и СЗО";Новосибирск=Сибирь
# WAREHOUSE_CLUSTERS=

##################################
# ====== AUTO SUPPLY (BASE) ==== #
##################################
# Файл хранения задач авто-заявок
SUPPLY_TASK_FILE=supply_tasks.json

# Базовая задержка (сек) для backoff и максимальная
SUPPLY_BACKOFF_BASE=600
SUPPLY_BACKOFF_MAX=7200

# Интервал фоновой проверки (минуты) базовой логики (старый)
SUPPLY_WATCH_INTERVAL_MINUTES=5

# За сколько секунд до начала окна начинать попытки
SUPPLY_EARLY_SECONDS=900   # 15 минут

# Через сколько дней чистить завершённые задачи
SUPPLY_PURGE_AGE_DAYS=7

# Маппинг "читаемое имя склада" -> warehouse_id
# Если оставить пустым, будет работать старый формат (ID напрямую)
SUPPLY_WAREHOUSE_MAP=СОФЬИНО_РФЦ=1020000241710000,ДОМОДЕДОВО_РФЦ=1020001853757000,ЖУКОВСКИЙ_РФЦ=1020000115166000,ГРИВНО_РФЦ=1020000435290000,ПЕТРОВСКОЕ_РФЦ=23948599159000,ПУШКИНО_1_РФЦ=23843917228000,ПУШКИНО_2_РФЦ=23902289166000,ТВЕРЬ_РФЦ=23021125185000,ХОРУГВИНО_РФЦ=15431806189000,НОГИНСК_РФЦ=1020000759116000,Хоругвино_РФЦ_НЕГАБАРИТ=19262731541000,ГРИВНО_РФЦ_НЕГАБАРИТ=1020000989855000,РАДУМЛЯ_РФЦ_НЕГАБАРИТ=1020002007811000,ХОРУГВИНО_РФЦ_ПАЛЛЕТНЫЙ=1020002458344000,ПАВЛО_СЛОБОДСКОЕ_РФЦ_НЕГАБАРИТ=1020000268887000,НОГИНСК_РФЦ_НЕГАБАРИТ=1020001642383000,Тверь_Хаб=6048863967000,ЯРОСЛАВЛЬ_РФЦ=1020002006967000,СПБ_КОЛПИНО_РФЦ=1020001649180000,СПБ_БУГРЫ_РФЦ=23903599483000,СПБ_ШУШАРЫ_РФЦ=1020000613861000,Санкт_Петербург_РФЦ=18044249781000,СПБ_ШУШАРЫ_РФЦ_НЕГАБАРИТ=1020001025471000,СПБ_БУГРЫ_РФЦ_ЮВЕЛИРНЫЙ=1020000974650000,СПБ_ВОЛХОНКА_РФЦ_НЕГАБАРИТ=1020001443754000,СПБ_ВОЛХОНКА_2_РФЦ_ПАЛЛЕТНЫЙ=1020002458103000,Екатеринбург_РФЦ_НОВЫЙ=18044570445000,ЕКАТЕРИНБУРГ_РФЦ_НЕГАБАРИТ=1020001135128000,ЕКАТЕРИНБУРГ_РФЦ_ЮВЕЛИРНЫЙ=1020001351115000,ПЕРМЬ_РФЦ=1020001853819000,САМАРА_РФЦ=23128509046000,САМАРА_РФЦ_НЕГАБАРИТ=1020001443623000,САМАРА_РФЦ_ЮВЕЛИРНЫЙ=1020001351192000,НИЖНИЙ_НОВГОРОД_РФЦ=23599177351000,Казань_РФЦ_НОВЫЙ=18044494830000,КЗН_СТОЛБИЩЕ_РФЦ_НЕГАБАРИТ=1020002066005000,АДЫГЕЙСК_РФЦ=1020000267736000,НОВОРОССИЙСК_МРФЦ=23601604393000,АДЫГЕЙСК_РФЦ_ЮВЕЛИРНЫЙ=1020000974583000,Ростов_на_Дону_РФЦ=17717042026000,ЮЖНЫЙ_ОБХОД_РФЦ_НЕГАБАРИТ=1020001513671000,ВОРОНЕЖ_МРФЦ=23684735180000,ВОРОНЕЖ_РФЦ_НЕГАБАРИТ=1020002196480000,ВОРОНЕЖ_2_РФЦ=1020001007805000,ОМСК_РФЦ=1020001835468000,НОВОСИБИРСК_РФЦ_ЮВЕЛИРНЫЙ=1020001351145000,Новосибирск_РФЦ_НОВЫЙ=18044341087000,НЕВИННОМЫССК_РФЦ=1020001351243000,УФА_РФЦ=1020001836298000,УФА_РФЦ_КРОССДОКИНГ=1020001836368000,ОРЕНБУРГ_РФЦ=1020001836200000,ХАБАРОВСК_2_РФЦ=1020000890160000,ТЮМЕНЬ_РФЦ=1020002007530000,КРАСНОЯРСК_МРФЦ=22296628035000,САРАТОВ_РФЦ=1020001853897000,ВОЛГОГРАД_МРФЦ=1020000310035000,КАЛИНИНГРАД_МРФЦ=22294782253000,АСТАНА_РФЦ=1020000367015000,АЛМАТЫ_2_РФЦ=1020001854016000

#############################################
# ====== AUTO SUPPLY (EXTENDED STEPS) ===== #
#############################################
# Интервалы поиска слотов и опроса асинхронных операций
SLOT_POLL_INTERVAL_SECONDS=180
OPERATION_POLL_INTERVAL_SECONDS=25
OPERATION_POLL_TIMEOUT_SECONDS=600
# Интервал фонового джоба обработки задач (секунды)
SUPPLY_JOB_INTERVAL=45

# Сколько раз максимум повторять ожидание operation прежде чем FAIL
SUPPLY_MAX_OPERATION_RETRIES=25

# Сколько раз максимум терпеливо ждать появления слота / capacity
SUPPLY_MAX_CAPACITY_RETRIES=200

# Допуск в минутах при подборе таймслота (0 = точное совпадение)
SLOT_MATCH_TOLERANCE_MINUTES=0

# Автоматические этапы
AUTO_CREATE_CARGOES=1
AUTO_CREATE_LABELS=1
AUTO_SEND_LABEL_PDF=1
AUTO_BOOK_PASS=0

# Поведение при неожиданных ошибках операций: FAIL или RETRY (пока FAIL)
SUPPLY_OPERATION_FAIL_ACTION=FAIL

# Тип поставки по умолчанию — КРОСС-ДОКИНГ
# (было CREATE_TYPE_DIRECT)
SUPPLY_TYPE_DEFAULT=CREATE_TYPE_CROSSDOCK

# Резерв: можно задать cluster_ids, если понадобится ограничивать поиск
# SUPPLY_CLUSTER_IDS=123,456

# Резерв на будущее: авто изменение слота (пока не используем)
# AUTO_RESCHEDULE_SLOT=0

############################################
# ====== DROP-OFF / CROSS-DOCK (ENV) ===== #
############################################
# Drop-off склад для отгрузки (УФА_РФЦ_КРОССДОКИНГ)
# Если задан и ID, и NAME — будет использоваться ID, NAME для удобства логов
OZON_DROP_OFF_NAME=УФА_РФЦ_КРОССДОКИНГ
OZON_DROP_OFF_ID=1020001836368000
# Локальная тайм-зона drop-off склада (Екатеринбург)
OZON_DROP_OFF_TZ=Asia/Yekaterinburg

# Режим нормализации дат/времени для поиска таймслотов:
# ALIGN — трактовать время как локальное для drop-off TZ и конвертировать в UTC
OZON_TS_MODE=ALIGN

# Карта тайм-зон по складам, чтобы корректно формировать UTC-диапазоны
# (пример: приёмка ХОРУГВИНО в Европе/Москва, drop-off УФА в Екатеринбурге)
OZON_WAREHOUSE_TZ_MAP={"15431806189000":"Europe/Moscow","1020001836368000":"Asia/Yekaterinburg"}

##################################
# ====== LOGGING / MISC ========= #
##################################
LOG_LEVEL=DEBUG
# WAIT_FOR_TELEGRAM_TOKEN=0
# STARTUP_WAIT_MAX_SECONDS=120
